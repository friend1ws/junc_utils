#! /usr/bin/env python

from junc_utils.run import *
import argparse

parser = argparse.ArgumentParser(prog = "junc_utils")

parser.add_argument("--version", action = "version", version = "junc_utils-0.1.0beta")

subparsers = parser.add_subparsers()

##########
# filter

filter = subparsers.add_parser("filter",
                               help = "filter out splicing junctions outside specified conditions")

filter.add_argument("junc_file", metavar = "sample.SJ.out.tab", default = None, type = str,
                    help = "the path to star junction file")

filter.add_argument("output_path", metavar = "output.txt", default = None, type = str,
                    help = "the path to the output file")

filter.add_argument("--read_num_thres", type = int, default = 3,
                    help = "remove splicing junctions whose supporting numbers are below this value (default: %(default)s)")
                           
filter.add_argument("--overhang_thres", type = int, default = 10,
                    help = "remove splicing junctions whose overhang sizes are this value (default: %(default)s)")
                           
filter.add_argument("--keep_annotated", default = False, action = 'store_true',
                    help = "do not remove annotated splicing junctions")

filter.add_argument("--pooled_control_file", default = None, type = str,
                    help = "the path to control data created by merge_control (default: %(default)s)")

filter.set_defaults(func = filter_main)

##########
# annotate

annotate = subparsers.add_parser("annotate",
                                 help = "annotate junctions")

annotate.add_argument("junc_file", metavar = "sample.SJ.out.tab", default = None, type = str,
                      help = "the path to star splicing junction file")

annotate.add_argument("output_path", metavar = "output.txt", default = None, type = str,
                      help = "the path to the output file")

annotate.add_argument("annotation_dir", metavar = "annotation_dir", default = None, type = str,
                      help = "the path to the database directory")

annotate.add_argument("--junction_margin", type = int, default = 3,
                      help = "the allowed margin size for the difference between splicing breakpoints and exon-intron junctions")

annotate.add_argument("--exon_margin", type = int, default = 30,
                      help = "the allowed margin size for the difference between splicing breakpoints and exonic region")

annotate.set_defaults(func = annotate_main)

##########
# merge control
merge_control = subparsers.add_parser("merge_control",
                                      help = "merge, compress and index the splicing junction list (.SJ.out.tab file generated by STAR)")

merge_control.add_argument("junc_list", metavar = "junc_list.txt", default = None, type = str,
                           help = "junction path list")

merge_control.add_argument("output_path", default = None, type = str,
                           help = "the path of the output file")


merge_control.add_argument("--read_num_thres", type = int, default = 3,
                           help = "remove splicing junctions whose supporting numbers are below this value (default: %(default)s)")

merge_control.add_argument("--overhang_thres", type = int, default = 10,
                           help = "remove splicing junctions whose overhang sizes are this value (default: %(default)s)")

merge_control.add_argument("--keep_annotated", default = False, action = 'store_true', 
                           help = "do not remove annotated splicing junctions")

merge_control.add_argument("--sample_num_thres", type = int, default = 2,
                           help = "register splicing junctions at least shared by specified number of samples (default: %(default)s)")

merge_control.set_defaults(func = merge_control_main)


##########

args = parser.parse_args()

args.func(args)


